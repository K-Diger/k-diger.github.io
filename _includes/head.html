<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta content="#f7f7f7" media="(prefers-color-scheme: light)" name="theme-color">
  <meta content="#1b1b1e" media="(prefers-color-scheme: dark)" name="theme-color">
  <meta content="yes" name="mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
    name="viewport"
  >

  {%- capture seo_tags -%}
  {% seo title=false %}
  {%- endcapture -%}

  <!-- Setup Open Graph image -->

  {% if page.image %}
  {% assign src = page.image.path | default: page.image %}

  {% unless src contains '://' %}
  {%- capture img_url -%}
  {% include media-url.html src=src subpath=page.media_subpath absolute=true %}
  {%- endcapture -%}

  {%- capture old_url -%}{{ src | absolute_url }}{%- endcapture -%}
  {%- capture new_url -%}{{ img_url }}{%- endcapture -%}

  {% assign seo_tags = seo_tags | replace: old_url, new_url %}
  {% endunless %}

  {% elsif site.social_preview_image %}
  {%- capture img_url -%}
  {% include media-url.html src=site.social_preview_image absolute=true %}
  {%- endcapture -%}

  {%- capture og_image -%}
  <meta content="{{ img_url }}" property="og:image"/>
  {%- endcapture -%}

  {%- capture twitter_image -%}
  <meta content="summary_large_image" name="twitter:card"/>
  <meta content="{{ img_url }}" property="twitter:image"/>
  {%- endcapture -%}

  {% assign old_meta_clip = '
  <meta content="summary" name="twitter:card"/>
  ' %}
  {% assign new_meta_clip = og_image | append: twitter_image %}
  {% assign seo_tags = seo_tags | replace: old_meta_clip, new_meta_clip %}
  {% endif %}

  {{ seo_tags }}

  {%- if site.social.fediverse_handle %}
  <!-- Fediverse handle/creator -->
  <meta content="{{ site.social.fediverse_handle }}" name="fediverse:creator">
  {% endif %}

  <title>
    {%- unless page.layout == 'home' -%}
    {%- capture title -%}
    {%- if page.collection == 'tabs' -%}
    {%- assign tab_key = page.title | downcase -%}
    {{- site.data.locales[include.lang].tabs[tab_key] -}}
    {%- else -%}
    {{- page.title -}}
    {%- endif -%}
    {%- endcapture -%}
    {{- title | append: ' | ' -}}
    {%- endunless -%}
    {{- site.title -}}
  </title>

  {% include_cached favicons.html %}

  <!-- Resource Hints -->
  {% unless site.assets.self_host.enabled %}
  {% for hint in site.data.origin.cors.resource_hints %}
  {% for link in hint.links %}
  <link href="{{ hint.url }}" join: link.opts rel="{{ link.rel }}" {{ |
  ' ' }}>
  {% endfor %}
  {% endfor %}
  {% endunless %}

  <!-- Bootstrap -->
  {% unless jekyll.environment == 'production' %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  {% endunless %}

  <!-- Theme style -->
  <link href="{{ '/assets/css/:THEME.css' | replace: ':THEME', site.theme | relative_url }}" rel="stylesheet">

  <!-- Web Font -->
  <link href="{{ site.data.origin[type].webfonts | relative_url }}" rel="stylesheet">

  <!-- JetBrains Mono Font for Code -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Font Awesome Icons -->
  <link href="{{ site.data.origin[type].fontawesome.css | relative_url }}" rel="stylesheet">

  <!-- 3rd-party Dependencies -->

  {% if site.toc and page.toc %}
  <link href="{{ site.data.origin[type].toc.css | relative_url }}" rel="stylesheet">
  {% endif %}

  {% if page.layout == 'post' or page.layout == 'page' or page.layout == 'home' %}
  <link href="{{ site.data.origin[type]['lazy-polyfill'].css | relative_url }}" rel="stylesheet">
  {% endif %}

  {% if page.layout == 'page' or page.layout == 'post' %}
  <!-- Image Popup -->
  <link href="{{ site.data.origin[type].glightbox.css | relative_url }}" rel="stylesheet">
  {% endif %}

  <!-- Scripts -->

  <script src="{{ '/assets/js/dist/theme.min.js' | relative_url }}"></script>

  {% include js-selector.html lang=lang %}

  {% if jekyll.environment == 'production' %}
  <!-- PWA -->
  {% if site.pwa.enabled %}
  <script
    defer
    src="{{ '/app.min.js' | relative_url }}?baseurl={{ site.baseurl | default: '' }}&register={{ site.pwa.cache.enabled }}"
  ></script>
  {% endif %}

  <!-- Web Analytics -->
  {% for analytics in site.analytics %}
  {% capture str %}{{ analytics }}{% endcapture %}
  {% assign platform = str | split: '{' | first %}
  {% if site.analytics[platform].id and site.analytics[platform].id != empty %}
  {% include analytics/{{ platform }}.html %}
  {% endif %}
  {% endfor %}
  {% endif %}

  {% include metadata-hook.html %}
</head>
